!function(e,t){for(var i in t)e[i]=t[i]}(exports,function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=5)}([function(e,t){e.exports=require("@findy-sources/meta")},function(e,t){e.exports=require("ramda")},function(e,t){e.exports=require("tslib")},function(e,t){e.exports=require("@findy-sources/util")},function(e,t){e.exports=require("deep-freeze")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(6);t.default=r.default},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),n=i(3),o=i(4),s=i(1),a=i(7),u=i(12);t.default=(e=>t=>{let i=u.default(t);const c=e.filter(({condition:e})=>!e||e(i)).map(({name:e,source:t,persistContext:r})=>({name:e,initializedSource:t(i),removeGarbageAndSeen:a.RemoveGarbageAndSeen(),persistMiddleware:r?a.PersistContext():s.identity}));return function(e){let t=o(s.clone(e));return s.flatten(c.map(({name:e,initializedSource:o,removeGarbageAndSeen:u,persistMiddleware:c})=>{return(e=>e?Array.isArray(e)?e.filter(Boolean):[e]:[])(o(t)).map((o,l)=>({name:[e,l].filter(Boolean).join(" "),iterate:n.pipe(a.DefaultFetch(),c,a.Context(),u,a.Test(e,i,t),a.NoResultsChecker(10,e,i,t),a.ConvertItemsToPublicAPI(),r.options.enableChunking?a.Chunk(e,r.options.chunkSize):s.identity)(o)}))}))}})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(0),o=i(8),s=i(9);t.DefaultFetch=(()=>e=>(t,i=n.options.httpFetchFn)=>e(t,i)),t.LogCtx=(e=>t=>(i,n)=>r.__awaiter(this,void 0,void 0,function*(){console.log(`logCtx got context in ${e}:`,i);const r=yield t(i,n);return console.log(`logCtx set context in ${e}:`,r.context),r})),t.Context=(()=>e=>(t,i)=>{if(t){if(t.done)throw"EXHAUSTED";return e(t,i)}return e(void 0,i)});const a={discards:[],warnings:[],calls:[]};t.Chunk=((e,t)=>e=>{let i=[],n=void 0;return(o,s)=>r.__awaiter(this,void 0,void 0,function*(){if(i.length>0){const e=i.slice(0,t);if((i=i.slice(t)).length>0)return Object.assign({},a,{values:e,context:o});if(void 0!==n){const t=Object.assign({},a,{values:e,context:n});return n=void 0,t}throw"ChunkMiddleware: nextContext is not defined"}{if(n)throw"Should not have context here";const r=yield e(o,s),a=r.values.slice(0,t);return(i=r.values.slice(t)).length>0?(n=r.context,Object.assign({},r,{values:a,context:o})):(n=void 0,Object.assign({},r,{values:a}))}})}),t.RemoveGarbageAndSeen=(()=>{const e=new Set;return t=>(i,n)=>r.__awaiter(this,void 0,void 0,function*(){const r=yield t(i,n),o=r.values.filter(e=>e&&e.id),s=o.filter(t=>!e.has(t.id));return s.forEach(t=>e.add(t.id)),Object.assign({},r,{values:s,seen:o.length-s.length})})}),t.NoResultsChecker=((e,t,i,n)=>o=>{let s=0;return(a,u)=>r.__awaiter(this,void 0,void 0,function*(){const r=yield o(a,u);if(0===r.values.length){if(++s>=e)throw`Unable to get new items in ${e} iterations, terminating.\n`+`source: ${t}\n`+`options: ${JSON.stringify(n)}\n`+`profile: ${JSON.stringify(i)}`}else s=0;return r})}),t.Test=((e,t,i)=>n=>(o,a)=>r.__awaiter(this,void 0,void 0,function*(){const r=yield n(o,a),{values:u,discards:c,warnings:l}=s.default({profile:t,options:i,iteratorName:e,items:r.values});return Object.assign({},r,{values:u,discards:c,warnings:l})})),t.ConvertItemsToPublicAPI=(()=>e=>(t,i)=>r.__awaiter(this,void 0,void 0,function*(){const r=yield e(t,i),n=r.values.map(o.default),s=r.discards.map(({fails:e,item:t})=>({fails:e,item:o.default(t)}));return Object.assign({},r,{values:n,discards:s})})),t.PersistContext=(()=>{let e;return t=>(i,r)=>(i&&(e=i),t(i||e,r))})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(1);t.default=function(e){const{attributes:t={}}=e,i=r.__rest(e,["attributes"]);return Object.assign({attributes:n.pickBy(e=>!n.isNil(e),t)},i)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(0),o=i(3),s=i(10),a=i(1),u=new s({schemaId:"auto",allErrors:!0});u.addMetaSchema(i(11)),u.addSchema(n.ItemSchema,"Item");const c=[function(){return{message:()=>"missing or incorrect id",subject:a.prop("id"),test:e=>"string"==typeof e.id&&e.id.length>0}},function(){return{message:()=>"missing or incorrect title",subject:e=>e.title,test:e=>"string"==typeof e.title&&e.title.length>0}},function(){return{message:()=>"missing or incorrect URL",subject:e=>e.url,test:e=>"string"==typeof e.url&&/^https?/.test(e.url)}},function(){return{message:()=>"missing or incorrect photoUrl",subject:e=>e.photoUrl,test:e=>"string"==typeof e.photoUrl&&/^https?/.test(e.photoUrl)&&!/coming.soon|unavailable|noimage/.test(e.photoUrl)}},function(e){if(!n.isPetProfile(e.profile)&&!n.isFoodProfile(e.profile))return{message:()=>"missing or incorrect price",subject:e=>e.attributes.price,test:e=>(function(e){return void 0!==e&&"object"==typeof e&&(Number.isFinite(e.min)||Number.isFinite(e.max))})(e.attributes.price)&&(e.attributes.price.min>0||e.attributes.price.max>0)}},function(e){if(!n.isPetProfile(e.profile)&&!n.isHomeProfile(e.profile)&&!n.isFoodProfile(e.profile)){const t=e.profile.price;if(t)return{message:()=>(function(e,t){return`${t} is not between ${e.min||0} and ${"max"in e?e.max:"Infinity"}`})(t,"price"),subject:e=>e.attributes.price,test:e=>!e.attributes.price||function(e,t){const{min:i=-1/0,max:r=1/0}=e,{min:n=-1/0,max:o=1/0}=t;return i<=o&&n<=r}(e.attributes.price,t)}}},function(e){if("hotel"===e.profile.category){const t=e.profile.accommodation;if(t){const e=e=>e.attributes.accommodation;return{message:()=>`accommodation is not ${t.join(" or ")}`,subject:e,test:i=>t.includes(e(i))}}}},function(e){if("hotel"===e.profile.category){const t=e.profile.facilities;if(t){const e=e=>e.attributes.facilities;return{message:()=>`facilities does not include ${t}`,subject:e,test:i=>{const r=e(i);return r&&t.every(e=>-1!==r.indexOf(e))}}}}},function(e){if("hotel"===e.profile.category){const t=e.profile.guestRating&&e.profile.guestRating.min;if(t){const e=e=>e.attributes.guestRating;return{message:()=>`guest rating is lower then ${t} or incorrect`,subject:e,test:i=>e(i)&&"number"==typeof e(i).min&&e(i).min>=t}}}},function(e){if("hotel"===e.profile.category){const t=e.profile.starRating&&e.profile.starRating.min;if(t){const e=e=>e.attributes.starRating;return{message:()=>`star rating is lower then ${t} or incorrect`,subject:e,test:i=>e(i)&&"number"==typeof e(i).min&&e(i).min>=t}}}},function(e){const t=n.isTransportProfile(e.profile)&&e.profile.compound,i=e=>[e.title,e.attributes.make].filter(Boolean).join(" ");if(t&&!t.model)return{message:()=>`make is not ${t.make}`,subject:e=>i(e),test:e=>o.getSynonymsArray(t.make).some(t=>o.fuzzyIncludes(t,i(e)))}},function(e){const t=n.isTransportProfile(e.profile)&&e.profile.compound,i=e=>[e.title,e.attributes.model].filter(Boolean).join(" ");if(t&&t.model)return{message:()=>`model is not ${t.model}`,subject:i,test:e=>(function(e,t){if(o.getSynonymsArray(e.model).some(e=>o.fuzzyIncludes(e,t)))return!0;if("BMW"===e.make){const i=e.model.match(/(\d) Series/);if(i&&-1!==t.toLowerCase().indexOf("bmw")&&t.toLowerCase().match("(^|\\s)"+i[1]+"\\d\\d"))return!0}})({make:t.make,model:t.model},i(e))}},function(e){const t=n.isTransportProfile(e.profile)&&e.profile.compound&&e.profile.compound.trim||void 0,i=e=>[e.title,e.attributes.trim].filter(Boolean).join(" ");if(t)return{message:()=>`trim is not ${t}`,subject:i,test:e=>i(e).toLowerCase().indexOf(t.toLowerCase())>-1}},function(e){if(n.isTransportProfile(e.profile)&&e.profile.year){const t=e.profile.year,i=o.rangeToArray(o.complementYearRange(t)),r=e=>`${e.attributes.year?`[${e.attributes.year.min} - ${e.attributes.year.max}] `:""}${e.title}`;if(i){const e=o.yearsArrayToRegExp(i);return{message:()=>`year is not in the range ${t.min} - ${t.max} or unknown`,subject:r,test:t=>e.test(r(t))}}}},function(e){if(n.isPetProfile(e.profile)){const t=e.profile.age;if(t){const e=e=>e.attributes.age;return{message:()=>`age is not ${t}`,subject:e,test:i=>t.includes(e(i))}}}},function(e){if(n.isPetProfile(e.profile)){const t=e.profile.gender&&e.profile.gender[0];if(t){const e=e=>e.attributes.gender;return{message:()=>`gender is not ${t}`,subject:e,test:i=>e(i)&&e(i).includes(t)}}}},function(e){if(n.isProductProfile(e.profile)&&e.profile.condition&&e.profile.condition.length>0){const t=e.profile.condition,i=e=>e.attributes.condition,r=o.pipe(i,e=>e.some(e=>t.includes(e)));return{message:()=>`condition does not matches profile (${t})`,subject:i,test:e=>!i(e)||r(e)}}}],l=[function(e){if(n.isProductProfile(e.profile)){const t=e.profile.keyword;if(t){const e=e=>e.title;return{message:()=>`keyword "${o.applySynonyms(t)}" is not found in title`,subject:e,test:i=>o.getSynonymsVariants(t).some(t=>o.fuzzyIncludes(t,e(i)))}}}}];function f(e,t){const i=[];let r=!0;return e.forEach(e=>{e.test(t)||(r=!1,i.push({reason:e.message(),value:function(e){return Array.isArray(e)?JSON.stringify(e):e}(e.subject(t))}))}),{valid:r,fails:i}}t.default=function(e){const t=c.map(t=>t(e)).filter(Boolean),i=l.map(t=>t(e)).filter(Boolean),o=[],s=[],a=[];return JSON.parse(JSON.stringify(e.items.filter(e=>e),(e,t)=>null===t?void 0:t)).forEach(c=>{var{discard:l}=c,m=r.__rest(c,["discard"]);if(u.validate(`Item#/definitions/${n.itemCategoryGroups[e.profile.category]}`,m))if(l)s.push({item:m,fails:l});else{const{valid:e,fails:r}=f(t,m);if(e){o.push(m);const{valid:e,fails:t}=f(i,m);e||a.push({item:m,fails:t})}else s.push({item:m,fails:r})}else s.push({item:m,fails:u.errors.map(e=>({reason:"Item scheme missmatch",value:`${e.dataPath?`${e.dataPath}: `:""}${e.message}`}))})}),{values:o,discards:s,warnings:a}}},function(e,t){e.exports=require("ajv")},function(e){e.exports={$schema:"http://json-schema.org/draft-06/schema#",$id:"http://json-schema.org/draft-06/schema#",title:"Core schema meta-schema",definitions:{schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type:["object","boolean"],properties:{$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},title:{type:"string"},description:{type:"string"},default:{},examples:{type:"array",items:{}},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:{}},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:{},enum:{type:"array",minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},default:{}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(2),n=i(0),o=i(4),s=i(1),a=i(13),u={dog:"pet:dog",cat:"pet:cat",rabbit:"pet:rabbit",horse:"pet:horse",small_furry:"pet:small_furry",bird:"pet:bird",pig:"pet:pig",reptile_and_other:"pet:reptile_and_other",farm:"pet:farm",rent:"home:rent",buy:"home:buy"};t.default=function(e){let t=s.clone(e);const{attributes:i,geolocation:c}=t,l=r.__rest(t,["attributes","geolocation"]);let f=Object.assign({},i,{geolocation:Object.assign({},c)},l);if(u[f.category]&&(f.category=u[f.category]),n.isPetProfile(f)||n.isProductProfile(f)||(f.price=f.price||{},f.price.min=Math.max(1,f.price.min||1)),"classic"===f.category){const{min:e=1900,max:t=1980}=f.year||{};f.year={min:e,max:t},f.category="auto"}return n.isProductProfile(f)&&f.condition&&2===f.condition.length&&(f=s.dissoc("condition",f)),a.default(f),o(f),f}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);t.default=(e=>{const{category:t}=e;if(!r.isPetProfile(e)&&!r.isFoodProfile(e)&&e.price&&void 0!==e.price.min&&void 0!==e.price.max&&e.price.min>e.price.max)throw new TypeError("Invalid price value");const i=r.filters[t];if(!i)throw new TypeError(`Unknown category: ${t}`);Object.keys(i).forEach(r=>{const n=i[r],o=e[r],s=e=>{throw new TypeError(`${t} ${r} ${e}`)};n.required&&!o&&s("is not set"),o&&("list"===n.type&&(Array.isArray(o)||s("should be array"),o.forEach(e=>{if(!n.values.includes(e)){const t=n.values.join(" | ");s(`has incorrect item "${e}", expected one of ${t}`)}})),"date-range"===n.type?o.starts&&o.ends||s('should have "starts" and "ends" properties'):"number"===n.type?(void 0===o.min&&void 0===o.max&&s('should have "min" or "max" properties'),void 0!==o.min&&void 0!==o.max&&o.min!==o.max&&s('"min" is not equal to "max"')):"range"===n.type?(void 0===o.min&&void 0===o.max&&s('should have "min" or "max" properties'),void 0!==o.min&&void 0!==o.max&&o.min>o.max&&s('"min" is greater then "max"')):"min-number"===n.type?void 0===o.min&&s('should have "min" property'):"max-number"===n.type&&void 0===o.max&&s('should have "max" property'))})})}]));